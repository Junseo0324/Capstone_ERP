<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout.html}">
<head>
    <title>소득세 관리</title>
    <link rel="stylesheet" type="text/css" href="/css/attendanceList.css">
    <script>
        function openAddBracketDialog() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('addBracketDialog').style.display = 'block';
        }

        function closeDialog() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('addBracketDialog').style.display = 'none';
        }

        function addTaxBracket() {
            const minIncome = document.getElementById('minIncome').value;
            const maxIncome = document.getElementById('maxIncome').value || null;
            const fixedAmount = document.getElementById('fixedAmount').value;
            const rate = document.getElementById('rate').value;

            fetch('/tax/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    minIncome: parseInt(minIncome),
                    maxIncome: maxIncome ? parseInt(maxIncome) : null,
                    fixedAmount: parseInt(fixedAmount),
                    rate: parseFloat(rate)
                })
            }).then(response => response.text())
              .then(result => {
                  if (result === "success") {
                      window.location.reload();
                  } else {
                      alert("과세표준 추가 실패: " + result);
                  }
              }).catch(error => console.error('Error:', error));
        }

        function deleteTaxBracket(id) {
            if (!confirm("정말 삭제하시겠습니까?")) return;

            fetch(`/tax/delete/${id}`, {
                method: 'DELETE'
            }).then(response => response.text())
              .then(result => {
                  if (result === "success") {
                      window.location.reload();
                  } else {
                      alert("삭제 실패: " + result);
                  }
              }).catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
<div layout:fragment="content">
    <h1>과세표준 관리</h1>
    <button class="btn-primary" onclick="openAddBracketDialog()">새 과세표준 추가</button>

    <div class="overlay" id="overlay" onclick="closeDialog()"></div>

    <div class="dialog" id="addBracketDialog">
        <h2>과세표준 추가</h2>
        <label for="minIncome">과세표준 구간 (최소):</label>
        <input type="number" id="minIncome" required />

        <label for="maxIncome">과세표준 구간 (최대):</label>
        <input type="number" id="maxIncome" placeholder="최대값이 없으면 비워두세요" />

        <label for="fixedAmount">고정 세액:</label>
        <input type="number" id="fixedAmount" required />

        <label for="rate">세율 (%):</label>
        <input type="number" id="rate" step="0.01" required />

        <button class="btn-primary" onclick="addTaxBracket()">추가</button>
        <button class="btn-secondary" onclick="closeDialog()">취소</button>
    </div>

    <table>
        <thead>
        <tr>
            <th>과세표준 구간 (최소)</th>
            <th>과세표준 구간 (최대)</th>
            <th>고정 세액</th>
            <th>세율 (%)</th>
            <th>작업</th> <!-- 삭제 버튼 열 추가 -->
        </tr>
        </thead>
        <tbody>
        <tr th:each="bracket : ${taxBrackets}">
            <td th:text="${bracket.minIncome}"></td>
            <td th:text="${bracket.maxIncome != null ? bracket.maxIncome : '무한대'}"></td>
            <td th:text="${bracket.fixedAmount}"></td>
            <td th:text="${bracket.rate}"></td>
            <td>
                <button class="btn-secondary" onclick="deleteTaxBracket([[${bracket.id}]])">삭제</button>
            </td>
        </tr>
        <tr th:if="${taxBrackets == null or #lists.isEmpty(taxBrackets)}">
            <td colspan="5">과세표준이 없습니다.</td>
        </tr>
        </tbody>
    </table>
</div>


</body>
</html>
