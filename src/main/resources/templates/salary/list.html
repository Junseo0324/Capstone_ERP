<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>월별 모든 직원 급여 내역</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; text-align: center; border-bottom: 1px solid #ddd; }
        th { background-color: #4CAF50; color: white; }
        .navigation { text-align: center; margin-bottom: 20px; }
        .navigation button { background: none; border: none; font-size: 1.5em; cursor: pointer; }
    </style>
</head>
<body>
<h1>월별 모든 직원 급여 내역</h1>

<!-- 달 이동 버튼 -->
<div class="navigation">
    <button onclick="navigateMonth(-1)">&#9664; 이전 달</button>
    <span th:text="${month} + '월 급여 내역'"></span>
    <button onclick="navigateMonth(1)">다음 달 &#9654;</button>
</div>

<input type="hidden" id="currentMonth" th:value="${month}">

<table>
    <thead>
    <tr>
        <th>직원 이름</th>
        <th>월 급여</th>

        <!-- 추가 수당 항목 헤더 -->
        <th th:each="allowanceHeader : ${allowanceHeaders}" th:text="${allowanceHeader}"></th>
        <th>총 추가 수당</th>

        <!-- 공제 항목 헤더 -->
        <th th:each="deductionHeader : ${deductionHeaders}" th:text="${deductionHeader}"></th>
        <th>총 공제 사항</th>
        <th>총 급여</th>
    </tr>
    </thead>
    <tbody>
    <!-- 직원별 급여 내역 -->
    <tr th:each="salaryDetail : ${salaryDetails}">
        <!-- 직원 이름 -->
        <td th:text="${salaryDetail['employeeName']}"></td>

        <!-- 월 급여 -->
        <td th:text="${#numbers.formatDecimal(salaryDetail['monthlySalary'], 0, 0)}"></td>

        <!-- 추가 수당 항목 값 -->
        <td th:each="allowanceHeader : ${allowanceHeaders}"
            th:text="${#numbers.formatDecimal(salaryDetail['allowanceDetails'].getOrDefault(allowanceHeader, 0), 0, 0)}"></td>

        <!-- 총 추가 수당 -->
        <td th:text="${#numbers.formatDecimal(salaryDetail['totalAllowance'], 0, 0)}"></td>

        <!-- 공제 항목 값 -->
        <td th:each="deductionHeader : ${deductionHeaders}"
            th:text="${#numbers.formatDecimal(salaryDetail['deductionDetails'].getOrDefault(deductionHeader, 0), 0, 0)}"></td>

        <!-- 총 공제 사항 -->
        <td th:text="${#numbers.formatDecimal(salaryDetail['totalDeductions'], 0, 0)}"></td>
        <td th:text="${#numbers.formatDecimal(salaryDetail['monthlySalary'], 0, 0)} + ${#numbers.formatDecimal(salaryDetail['totalAllowance'], 0, 0)}
                    -${#numbers.formatDecimal(salaryDetail['totalDeductions'], 0, 0)} "></td>
    </tr>

    <!-- 공제 내역이 없을 경우 -->
    <tr th:if="${#lists.isEmpty(salaryDetails)}">
        <td colspan="${4 + #lists.size(allowanceHeaders) + #lists.size(deductionHeaders)}" class="no-data">데이터가 없습니다.</td>
    </tr>
    </tbody>
</table>

<script>
    function navigateMonth(offset) {
        const currentMonthStr = document.getElementById("currentMonth").value; // 현재 달 가져오기
        let [year, month] = currentMonthStr.split('-').map(Number);

        month += offset;
        if (month < 1) {
            month = 12;
            year -= 1;
        } else if (month > 12) {
            month = 1;
            year += 1;
        }

        const newMonthStr = `${year}-${String(month).padStart(2, '0')}`;
        window.location.href = `/salary/list?month=${newMonthStr}`;
    }
</script>
</body>
</html>
